<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Word Guess Game</title>

    <link rel="stylesheet" href="./reset.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="./style.css">
</head>

<body>
    <div class="container-fluid shadow bg-dark text-center text-white py-4">
        <h1>Word Guess Game</h1>
        <h2 id="songName">Press any letter of the alphabet to get started!</h2>
    </div>
    <section>
        <div class="column shadow p-3 mb-5 bg-white rounded">
            <img src="https://via.placeholder.com/200" alt="placeholder">
        </div>
        <div class="column shadow p-3 mb-5 bg-white rounded">
            <p class = ""><strong>Wins</strong></p>
            <p id="wins">0</p>
            <hr>
            <p class = ""><strong>Current Word</strong></p>
            <p id="currentWord"></p>
            <hr>
            <p><strong>Number of Guesses Remaining</strong></p>
            <p id="guesses">12</p>
            <hr>
            <p class = ""><strong>Letters already guessed</strong></p>
            <p id="guessedLetters">None yet</p>
        </div>
    </section>

    <audio id="africa">
        <source src="./songs/africa.mp3" type="audio/mp3">
        Your browser does not support the audio element.
    </audio>

    <audio id="stairwaytoheaven">
        <source src="./songs/stairwaytoheaven.mp3" type="audio/mp3">
        Your browser does not support the audio element.
    </audio>

    <audio id="letsgroove">
        <source src="./songs/letsgroove.mp3" type="audio/mp3">
        Your browser does not support the audio element.
    </audio>
    
    <audio id="pyro">
        <source src="./songs/pyro.mp3" type="audio/mp3">
        Your browser does not support the audio element.
    </audio>
    
    <audio id="brandy">
        <source src="./songs/brandy.mp3" type="audio/mp3">
        Your browser does not support the audio element.
    </audio>
    
    <audio id="goalltheway">
        <source src="./songs/goalltheway.mp3" type="audio/mp3">
        Your browser does not support the audio element.
    </audio>
    
    <audio id="somebodyelse">
        <source src="./songs/somebodyelse.mp3" type="audio/mp3">
        Your browser does not support the audio element.
    </audio>
    
    <audio id="paradise">
        <source src="./songs/paradise.mp3" type="audio/mp3">
        Your browser does not support the audio element.
    </audio>
    
    <audio id="heyyou">
        <source src="./songs/heyyou.mp3" type="audio/mp3">
        Your browser does not support the audio element.
    </audio>
    
    <audio id="bennieandthejets">
        <source src="./songs/bennieandthejets.mp3" type="audio/mp3">
        Your browser does not support the audio element.
    </audio>
    
    <audio id="perfectplaces">
        <source src="./songs/perfectplaces.mp3" type="audio/mp3">
        Your browser does not support the audio element.
    </audio>
    
    <audio id="therubberbandman">
        <source src="./songs/therubberbandman.mp3" type="audio/mp3">
        Your browser does not support the audio element.
    </audio>
    
    <audio id="hymnfortheweekend">
        <source src="./songs/hymnfortheweekend.mp3" type="audio/mp3">
        Your browser does not support the audio element.
    </audio>
    
    <audio id="underpressure">
        <source src="./songs/underpressure.mp3" type="audio/mp3">
        Your browser does not support the audio element.
    </audio>

</body>
<script>
    let wins = 0;
    let guessRemainder = 12;
    let guessedLetters = [];
    let letterBools = [];

    const songNames = ["Africa", "Stairway to Heaven", "Lets Groove", "Pyro", "Brandy", "Go All The Way", "Somebody Else", "Paradise", "Hey You", "Bennie And The Jets", "Perfect Places", "The Rubberband Man", "Hymn for the Weekend", "Under Pressure"];
    let chosenSong = songNames[Math.floor(Math.random() * songNames.length)];
    let unformattedChosenSong = chosenSong;
    chosenSong = chosenSong.replace(/\s/g, '').toLowerCase(); //This removes spaces from the chosen song name.

    console.log("Chosen Song: " + chosenSong);

    let game = {
        listOutSpaces: function (array) {
            for (i = 0; i < array.length; i++) {
                document.getElementById("currentWord").innerHTML += "<span class = 'letter'>" + array[i] + "</span>"; //Maybe change to appendChild - see notes
            }
        },

        addUserGuessToSpaces: function (key) {
            for (i = 0; i < chosenSong.length; i++) {
                let parent = document.getElementById("currentWord");
                let child = parent.querySelectorAll("span");
                let spanChar = child[i].innerHTML;

                if (key === spanChar) {
                    child[i].style.fontSize = "16px";
                    letterBools[i] = true;
                }
            }
        },

        checkForWin: function (condition) {
            let result = true;
            for (let i = 0; i < letterBools.length; i++) {
                if (letterBools[i] == false) {
                    result = false;
                    break;
                }
            }
            return result;
        },


        createLetterBools: function () {
            for (let i = 0; i < chosenSong.length; i++) {
                letterBools.push(false);
            }
        },

        audio: {
            playSong: function (id) {
                let x = document.getElementById(id);
                x.play();
            },

            stopSong: function () {
                let x = document.querySelectorAll("audio");
                x.forEach(function(song) {
                    song.pause();
                })
            }
        },

        setImg: function (file) {
            let x = document.querySelector("img");
            x.src = "images/" + file + ".jpg";
        },

        restartGame: function () {
            game.audio.stopSong();
            game.audio.playSong(chosenSong);

            guessRemainder = 12;
            document.getElementById("guesses").innerHTML = guessRemainder;

            chosenSong = songNames[Math.floor(Math.random() * songNames.length)];
            unformattedChosenSong = chosenSong;
            chosenSong = chosenSong.replace(/\s/g, '').toLowerCase(); // remove spaces
            console.log("New song: " + chosenSong);

            document.getElementById("currentWord").innerHTML = "";

            game.listOutSpaces(chosenSong);

            guessedLetters = [];
            document.getElementById("guessedLetters").innerHTML = "";

            letterBools = [];

            game.createLetterBools();

            document.getElementById("guessedLetters").innerHTML = "None yet";
        },
    }

    // game run logic

    game.listOutSpaces(chosenSong);
    game.createLetterBools();

    document.onkeyup = function (logKey) {
        let userInput = logKey.key

        if (guessedLetters.indexOf(userInput) > -1) {
            console.log("already guessed that letter");
        } else {
            guessedLetters.push(userInput); // If not already guessed, push the char to the guessed list.

            if (chosenSong.indexOf(userInput) > -1) { //Checks to see if the user's input matches any letter in lowercased song name
                console.log("Correct guess: " + userInput);
                game.addUserGuessToSpaces(userInput);

                if (game.checkForWin() == true) { //Win logic
                    document.querySelector("img").style.visibility = "visible";
                    game.setImg(chosenSong);
                    document.querySelector("#songName").innerHTML = "Last round's song was: <em>" + unformattedChosenSong + "</em>";
                    game.restartGame();
                    console.log("YOU HAVE WON!");
                    wins++;
                    document.querySelector("#wins").innerHTML = wins;
                }
            } else {
                guessRemainder--;
                console.log("Lost a guess. Remaining: " + guessRemainder);
                document.getElementById("guesses").innerHTML = guessRemainder;
                if (document.getElementById("guessedLetters").innerHTML === "None yet") {
                    document.getElementById("guessedLetters").innerHTML = "";
                }
                document.getElementById("guessedLetters").innerHTML += userInput + ", "; //pushes wrong letter to guess letters p
            }

            if (guessRemainder <= 0) {
                console.log("Ending Game.");
                game.restartGame();
            }
        }
    }
</script>

</html>